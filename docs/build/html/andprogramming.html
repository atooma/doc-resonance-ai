
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3.4. Developing Modules &mdash; Resonance AI SDK 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/atooma.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Resonance AI SDK 2.1.0 documentation" href="index.html" />
    <link rel="up" title="3. Resonance Android SDK framework" href="android.html" />
    <link rel="next" title="3.5. Modules API Reference" href="andreference.html" />
    <link rel="prev" title="3.3. Defining Rules With XML" href="andxml.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Resonance AI SDK</a>
        <span class="navbar-text navbar-version pull-left"><b>2.1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstart.html">1. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#declaring-features-of-interest">1.1. Declaring Features of Interest</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#data-sources-definition">1.2. Data Sources Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#rule-engine-configuration">1.3. Rule Engine Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="iosstart.html">2. Resonance iOS SDK framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#add-the-sdk-to-your-xcode-project">2.1. Add the SDK to your Xcode Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#configure-the-app-capabilities">2.1.1. Configure the app capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#set-the-location-service-permission-string">2.1.2. Set the Location Service permission string</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#objective-c">2.1.3. Objective-C</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#all-set">2.1.4. All set!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#data-collector">2.2. Data Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#configure-the-collector">2.2.1. Configure the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#ask-for-permission">2.2.2. Ask for Permission</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#start-the-collector">2.2.3. Start the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#stop-the-collector">2.2.4. Stop the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#logger">2.2.5. Logger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#activity-tracking">2.3. Activity Tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#history">2.3.1. History</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#realtime-event-monitoring-beta">2.3.2. Realtime Event Monitoring (Beta)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="android.html">3. Resonance Android SDK framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="andcore.html">3.1. Core Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#modules">3.1.1. Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#rules">3.1.2. Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#data-analysis">3.1.3. Data Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andengine.html">3.2. Rules Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andengine.html#the-ruledefinition-class">3.2.1. The <em>RuleDefinition</em> Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="andengine.html#the-atooma-class">3.2.2. The <em>Atooma</em> Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="andengine.html#the-ruleconflictschecker-class">3.2.3. The <em>RuleConflictsChecker</em> Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andxml.html">3.3. Defining Rules With XML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#property-values">3.3.1. Property Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#external-provider-calls">3.3.2. External Provider Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#example">3.3.3. Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#atooma-binary-format">3.3.4. Atooma binary format</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.4. Developing Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-modules">3.4.1. Creating Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-value-types">3.4.2. Creating Value Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-triggers">3.4.3. Creating Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-condition-checkers">3.4.4. Creating Condition Checkers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trigger-and-condition-checker-affinity">3.4.5. Trigger and Condition Checker Affinity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-performers">3.4.6. Creating Performers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andreference.html">3.5. Modules API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#oauth-based-modules">3.5.1. OAuth Based Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#activity-manager">3.5.2. Activity Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#airplane">3.5.3. Airplane</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#alarm">3.5.4. Alarm</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#battery">3.5.5. Battery</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#bluetooth">3.5.6. Bluetooth</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#camera">3.5.7. Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#contacts">3.5.8. Contacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#core">3.5.9. Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#data-sync">3.5.10. Data Sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-dropbox">3.5.11. Dropbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#facebook">3.5.12. Facebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#google-calendar">3.5.13. Google Calendar</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#google-drive">3.5.14. Google Drive</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#gmail">3.5.15. Gmail</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#headphone">3.5.16. Headphone</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-instagram">3.5.17. Instagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#location">3.5.18. Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#notification">3.5.19. Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#shake">3.5.20. Shake</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#sms">3.5.21. SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#telephony">3.5.22. Telephony</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#text-to-speech">3.5.23. Text To Speech</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-twitter">3.5.24. Twitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#wifi">3.5.25. WiFi</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#weather">3.5.26. Weather</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andactivity.html">3.6. Activity Tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#theoretical-basis">3.6.1. Theoretical Basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#monitoring-events">3.6.2. Monitoring Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#accessing-activity-history">3.6.3. Accessing activity history</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#sub-activities">3.6.4. Sub Activities</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#next-steps">3.6.5. Next Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#bibliography">3.6.6. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andresonance.html">3.7. Resonance API Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#theoretical-basis">3.7.1. Theoretical Basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#resonanceapiclient-class">3.7.2. <em>ResonanceApiClient</em> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#data-collector">3.7.3. Data Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#advisor">3.7.4. Advisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#next-steps">3.7.5. Next Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#bibliography">3.7.6. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andexamples.html">3.8. Building Own Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-0-rule-engine-basics">3.8.1. Example 0 - Rule Engine Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-1-external-providers">3.8.2. Example 1 - External Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-2-custom-modules">3.8.3. Example 2 - Custom Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-3-xml-as-a-template">3.8.4. Example 3 - XML As A Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-4-parking-reminder">3.8.5. Example 4 - Parking Reminder</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-5-timeline">3.8.6. Example 5 - Timeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="android.html#stable-gradle-configuration">3.9. Stable Gradle Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="android.html#basic-manifest-configuration">3.10. Basic Manifest Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="android.html#changelog">3.11. Changelog</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contextapi.html">4. Context API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#basic-api">4.1. Basic API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#vehicle-api">4.2. Vehicle API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#user-places-api">4.3. User Places API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#on-foot-api">4.4. On Foot API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#entertainment-api">4.5. Entertainment API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#health-api">4.6. Health API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#business-api">4.7. Business API</a></li>
<li class="toctree-l2"><a class="reference internal" href="contextapi.html#holidays-api">4.8. Holidays API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="infoapi.html">5. Info API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#user-basic-habits">5.1. User Basic Habits</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#vehicle">5.2. Vehicle</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#suggestions">5.3. Suggestions</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#weather">5.4. Weather</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#traffic">5.5. Traffic</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#fitness">5.6. Fitness</a></li>
<li class="toctree-l2"><a class="reference internal" href="infoapi.html#shopping-habits">5.7. Shopping Habits</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">3.4. Developing Modules</a><ul>
<li><a class="reference internal" href="#creating-modules">3.4.1. Creating Modules</a><ul>
<li><a class="reference internal" href="#declaring-dependencies">3.4.1.1. Declaring Dependencies</a></li>
<li><a class="reference internal" href="#initializing-module">3.4.1.2. Initializing Module</a></li>
<li><a class="reference internal" href="#registering-components">3.4.1.3. Registering Components</a></li>
<li><a class="reference internal" href="#destroying-module">3.4.1.4. Destroying Module</a></li>
<li><a class="reference internal" href="#example">3.4.1.5. Example</a></li>
<li><a class="reference internal" href="#concurrency-synchronization">3.4.1.6. Concurrency &amp; Synchronization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-value-types">3.4.2. Creating Value Types</a><ul>
<li><a class="reference internal" href="#declaring-java-class">3.4.2.1. Declaring Java Class</a></li>
<li><a class="reference internal" href="#encoding-and-decoding-binary-format">3.4.2.2. Encoding and Decoding Binary Format</a></li>
<li><a class="reference internal" href="#utilities-for-encoding-decoding">3.4.2.3. Utilities for Encoding / Decoding</a></li>
<li><a class="reference internal" href="#value-type-arrays">3.4.2.4. Value Type Arrays</a></li>
<li><a class="reference internal" href="#id1">3.4.2.5. Example</a></li>
<li><a class="reference internal" href="#registering-value-types">3.4.2.6. Registering Value Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-triggers">3.4.3. Creating Triggers</a><ul>
<li><a class="reference internal" href="#declaring-parameters">3.4.3.1. Declaring Parameters</a></li>
<li><a class="reference internal" href="#declaring-variables">3.4.3.2. Declaring Variables</a></li>
<li><a class="reference internal" href="#activating-rules">3.4.3.3. Activating Rules</a></li>
<li><a class="reference internal" href="#intent-based-triggers">3.4.3.4. Intent Based Triggers</a></li>
<li><a class="reference internal" href="#alarm-based-triggers">3.4.3.5. Alarm Based Triggers</a></li>
<li><a class="reference internal" href="#custom-triggers">3.4.3.6. Custom Triggers</a></li>
<li><a class="reference internal" href="#registering-triggers">3.4.3.7. Registering Triggers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-condition-checkers">3.4.4. Creating Condition Checkers</a><ul>
<li><a class="reference internal" href="#id2">3.4.4.1. Declaring Parameters</a></li>
<li><a class="reference internal" href="#invoking-condition-checkers">3.4.4.2. Invoking Condition Checkers</a></li>
<li><a class="reference internal" href="#id3">3.4.4.3. Example</a></li>
<li><a class="reference internal" href="#registering-condition-checkers">3.4.4.4. Registering Condition Checkers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trigger-and-condition-checker-affinity">3.4.5. Trigger and Condition Checker Affinity</a></li>
<li><a class="reference internal" href="#creating-performers">3.4.6. Creating Performers</a><ul>
<li><a class="reference internal" href="#id4">3.4.6.1. Declaring Parameters</a></li>
<li><a class="reference internal" href="#id5">3.4.6.2. Declaring Variables</a></li>
<li><a class="reference internal" href="#invoking-performers">3.4.6.3. Invoking Performers</a></li>
<li><a class="reference internal" href="#id6">3.4.6.4. Example</a></li>
<li><a class="reference internal" href="#registering-performers">3.4.6.5. Registering Performers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="developing-modules">
<span id="andprogramming"></span><h1>3.4. Developing Modules<a class="headerlink" href="#developing-modules" title="Permalink to this headline">¶</a></h1>
<p>Atooma SDK allows to create new modules and components by exploiting a pre-defined set of <em>abstract classes</em>, as reported in table below:</p>
<table border="1" class="table-bordered docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component</th>
<th class="head">Classes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="programming.html#devmodules">Module</a></td>
<td><code class="docutils literal"><span class="pre">com.atooma.engine.Module</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="programming.html#devvaluetypes">Value Type</a></td>
<td><code class="docutils literal"><span class="pre">com.atooma.engine.ValueType</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="programming.html#devtriggers">Trigger</a></td>
<td><code class="docutils literal"><span class="pre">com.atooma.engine.IntentBasedTrigger</span></code>,
<code class="docutils literal"><span class="pre">com.atooma.engine.AlarmBasedTrigger</span></code>,
<code class="docutils literal"><span class="pre">com.atooma.engine.Trigger</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="programming.html#devconditioncheckers">Condition Checker</a></td>
<td><code class="docutils literal"><span class="pre">com.atooma.engine.ConditionChecker</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="programming.html#devperformers">Performer</a></td>
<td><code class="docutils literal"><span class="pre">com.atooma.engine.Performer</span></code></td>
</tr>
</tbody>
</table>
<div class="section" id="creating-modules">
<span id="devmodules"></span><h2>3.4.1. Creating Modules<a class="headerlink" href="#creating-modules" title="Permalink to this headline">¶</a></h2>
<p>Creating new modules requires to extend the abstract class <code class="docutils literal"><span class="pre">com.atooma.engine.Module</span></code>, including the following protected constructor and set of abstract methods to be implemented:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @param id</span>
<span class="cm"> *        Module identifier, to be unique among all available</span>
<span class="cm"> *        modules within Atooma enabled application.</span>
<span class="cm"> * @param version</span>
<span class="cm"> *        Module version, to be incremented every time new</span>
<span class="cm"> *        components are added.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="nf">Module</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">version</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to declare dependencies of this module</span>
<span class="cm"> * on other modules</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">declareDependencies</span><span class="o">();</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to initialize this module.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">init</span><span class="o">();</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to register components</span>
<span class="cm"> * (e.g. trigger, performer and so on).</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">();</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to deallocate resources when destroying</span>
<span class="cm"> * this module.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">();</span>
</pre></div>
</td></tr></table></div>
<p>All the methods above will be described in details in the following sections.</p>
<div class="section" id="declaring-dependencies">
<h3>3.4.1.1. Declaring Dependencies<a class="headerlink" href="#declaring-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Modules may depend on other modules in two different ways:</p>
<ol class="arabic simple">
<li><strong>Explicit dependency</strong> - This scenario occurs when one component within module relies on a value type belonging to another module. Let&#8217;s suppose for example that module performer uses value type <code class="docutils literal"><span class="pre">CORE.STRING</span></code>. This means that module depends on <code class="docutils literal"><span class="pre">CORE</span></code> module version 1. Reason for version 1 is that <code class="docutils literal"><span class="pre">STRING</span></code> value type is available in <code class="docutils literal"><span class="pre">CORE</span></code> module starting from that version.</li>
<li><strong>Implicit dependency</strong> - This scenario occurs when a module requires functionalities from another module for being initialized. Let&#8217;s think about <code class="docutils literal"><span class="pre">SMS</span></code> module. Obviously such module is meaningless in case device doesn&#8217;t include proper hardware for GSM communications. Presence of such hardware is determined by <code class="docutils literal"><span class="pre">TELEPHONY</span></code> module. In case <code class="docutils literal"><span class="pre">TELEPHONY</span></code> is not available, <code class="docutils literal"><span class="pre">SMS</span></code> itself is useless. That&#8217;s why <code class="docutils literal"><span class="pre">SMS</span></code> depends on <code class="docutils literal"><span class="pre">TELEPHONY</span></code> version 1.</li>
</ol>
<p>All dependencies must be declared within method <code class="docutils literal"><span class="pre">declareDependencies()</span></code>, that must include proper calls to the inherited method <code class="docutils literal"><span class="pre">declareDependency(String</span> <span class="pre">id,</span> <span class="pre">int</span> <span class="pre">version)</span></code>.</p>
<p>For example, in case of <code class="docutils literal"><span class="pre">SMS</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareDependencies</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareDependency</span><span class="o">(</span><span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
  <span class="n">declareDependency</span><span class="o">(</span><span class="s">&quot;TELEPHONY&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a module depends on another module, the first one will be loaded only if second one is successfully loaded and initialized.</p>
</div>
</div>
<div class="section" id="initializing-module">
<h3>3.4.1.2. Initializing Module<a class="headerlink" href="#initializing-module" title="Permalink to this headline">¶</a></h3>
<p>Modules are initialized by invoking method <code class="docutils literal"><span class="pre">init()</span></code>, that must define all operations to be perfomed for having module up and running. Method returns a boolean value for indicating whether initialization was successfully completed or not.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In case a module fails its initialization block, all modules depending on it won&#8217;t be initialized too.</p>
</div>
<p>For example, during its initialization, <code class="docutils literal"><span class="pre">TELEPHONY</span></code> module checks whether telephony service is available and a SIM card is present within the device or not. If not, the module and all modules depending on it won&#8217;t be loaded.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">();</span>
  <span class="n">TelephonyManager</span> <span class="n">tm</span> <span class="o">=</span> <span class="o">(</span><span class="n">TelephonyManager</span><span class="o">)</span> <span class="n">context</span>
                  <span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">TELEPHONY_SERVICE</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">tm</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">int</span> <span class="n">simState</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="na">getSimState</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">simState</span> <span class="o">==</span> <span class="n">TelephonyManager</span><span class="o">.</span><span class="na">SIM_STATE_ABSENT</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="registering-components">
<h3>3.4.1.3. Registering Components<a class="headerlink" href="#registering-components" title="Permalink to this headline">¶</a></h3>
<p>Once module initialization is completed, method <code class="docutils literal"><span class="pre">registerComponents()</span></code> is used for registering all components implemented by the module itself. Different registration methods are available for handling all possible component types:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Allows to register a value type.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerValueType</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sinceVersion</span><span class="o">,</span> <span class="n">ValueType</span> <span class="n">vt</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to register a trigger.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerTrigger</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sinceVersion</span><span class="o">,</span> <span class="n">Trigger</span> <span class="n">tr</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to register a condition checker.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerConditionChecker</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sinceVersion</span><span class="o">,</span> <span class="n">ConditionChecker</span> <span class="n">cc</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Allows to register a performer.</span>
<span class="cm"> */</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerPerformer</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sinceVersion</span><span class="o">,</span> <span class="n">Performer</span> <span class="n">pe</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>All methods above include three parameters:</p>
<ol class="arabic simple">
<li>The identifier of the component, that must be unique within its belonging group (e.g. just one trigger can have <code class="docutils literal"><span class="pre">RECEIVED</span></code> as identifier).</li>
<li>The module version starting from which component was available (this must be less or equal to the module version).</li>
<li>The component to register.</li>
</ol>
</div>
<div class="section" id="destroying-module">
<h3>3.4.1.4. Destroying Module<a class="headerlink" href="#destroying-module" title="Permalink to this headline">¶</a></h3>
<p>When Atooma engine is deactivated (e.g. when turning off device) all loaded modules are destroyed, following an order that is opposite to the one used for loading them.</p>
<p>Method <code class="docutils literal"><span class="pre">destroy()</span></code> is aimed to encapsulate logic for releasing specific module resources.</p>
</div>
<div class="section" id="example">
<h3>3.4.1.5. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Below is reported a sample structure for <code class="docutils literal"><span class="pre">SMS</span></code> module, including all concepts explained in previous sections.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_SMS</span> <span class="kd">extends</span> <span class="n">Module</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MODULE_ID</span> <span class="o">=</span> <span class="s">&quot;SMS&quot;</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MODULE_VERSION</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">_SMS</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">MODULE_ID</span><span class="o">,</span> <span class="n">MODULE_VERSION</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareDependencies</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareDependency</span><span class="o">(</span><span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">declareDependency</span><span class="o">(</span><span class="s">&quot;TELEPHONY&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">registerTrigger</span><span class="o">(</span><span class="s">&quot;INCOMING&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">TR_Incoming</span><span class="o">());</span>
    <span class="n">registerPerformer</span><span class="o">(</span><span class="s">&quot;SEND&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">PE_Send</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Initialization is always successful, unless dependencies are not fully satisfied. Two components are declared. First one is a trigger, allowing to listen for incoming message events. Second one is a performer, allowing to send messages.</p>
</div>
<div class="section" id="concurrency-synchronization">
<h3>3.4.1.6. Concurrency &amp; Synchronization<a class="headerlink" href="#concurrency-synchronization" title="Permalink to this headline">¶</a></h3>
<p>Modules and components have just one single instance within Atooma engine. This means for example that there is just one instance of <code class="docutils literal"><span class="pre">_SMS</span></code> module class and just one instance of its trigger <code class="docutils literal"><span class="pre">TR_Incoming</span></code>.</p>
<p>Atooma engine works in multi-threading mode and this means that several rules can be simultanously executed. When two or more rules use the same component, the same instance is shared between them.</p>
<p>Basing on this, it&#8217;s extremely important to properly handle eventual concurrency and synchronization issues when developing modules and components.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A good practice is to keep inside component classes some data structure for handling information related to specific rules (e.g. a Map with rule id as key).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Keep always in mind that same external resources can be accessed simultanously in different points even if their management is demanded to a single component.</p>
</div>
</div>
</div>
<div class="section" id="creating-value-types">
<span id="devvaluetypes"></span><h2>3.4.2. Creating Value Types<a class="headerlink" href="#creating-value-types" title="Permalink to this headline">¶</a></h2>
<p>Value types are components aimed to define, describe and manage data handled by the other components. Some examples are <code class="docutils literal"><span class="pre">STRING</span></code>, <code class="docutils literal"><span class="pre">NUMBER</span></code>, <code class="docutils literal"><span class="pre">TIMESTAMP</span></code> and <code class="docutils literal"><span class="pre">POSITION</span></code>. For each value type it&#8217;s important to define a binary representation, as already described in section <a class="reference internal" href="andxml.html#srd"><span class="std std-ref">Atooma binary format</span></a>. It&#8217;s convenient to represent values for a specific type by using dedicated Java objects to be used at runtime. Classes implementing value types are responsible for the conversion between Java objects and their binary representation and vice versa.</p>
<p>In order to implement a value type, class <code class="docutils literal"><span class="pre">com.atooma.engine.ValueType</span></code> must be extended. Implementation of following methods is required:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getValueClass</span><span class="o">()</span>
<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">decode</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getStringRepresentation</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="declaring-java-class">
<h3>3.4.2.1. Declaring Java Class<a class="headerlink" href="#declaring-java-class" title="Permalink to this headline">¶</a></h3>
<p>The implementation of the value type must declare which Java class to use for representing values for the managed type. Such class is declared by implementing method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getValueClass</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>For example, <code class="docutils literal"><span class="pre">CORE.TIMESTAMP</span></code> value type, used for representing date and time, internally uses a <code class="docutils literal"><span class="pre">Long</span></code> object (number of mills according to UNIX time notation). Its <code class="docutils literal"><span class="pre">getValueClass()</span></code> method is implemented as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getValueClass</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="encoding-and-decoding-binary-format">
<h3>3.4.2.2. Encoding and Decoding Binary Format<a class="headerlink" href="#encoding-and-decoding-binary-format" title="Permalink to this headline">¶</a></h3>
<p>Transformation from Java object to binary sequence is implemented through method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>When invoking it, method receives as argument a Java object of the type defined by the <code class="docutils literal"><span class="pre">getValueClass()</span></code> method. Provided value is never <code class="docutils literal"><span class="pre">null</span></code>.</p>
<p>The opposite transformation is executed by defining method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">Object</span> <span class="nf">decode</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
</pre></div>
</td></tr></table></div>
<p>Received value is never <code class="docutils literal"><span class="pre">null</span></code> (but the byte array can be empty). It&#8217;s good practice to check if received binary sequence is consistent with the value type definition. If not, method should throw an <code class="docutils literal"><span class="pre">Exception</span></code>.</p>
</div>
<div class="section" id="utilities-for-encoding-decoding">
<h3>3.4.2.3. Utilities for Encoding / Decoding<a class="headerlink" href="#utilities-for-encoding-decoding" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">ValueType</span></code> class provides to its subclasses some methods for simplifying the encoding / decoding operations for primitive Java types. Methods available for encoding are:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeBoolean</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">value</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeInt</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeLong</span><span class="o">(</span><span class="kt">long</span> <span class="n">value</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeDouble</span><span class="o">(</span><span class="kt">double</span> <span class="n">value</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeString</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>For example, in case of <code class="docutils literal"><span class="pre">CORE.TIMESTAMP</span></code>, the received object will be of <code class="docutils literal"><span class="pre">Long</span></code> type. The binary representation, in such case, will be performed by encoding the value of the received long variable as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">long</span> <span class="n">longValue</span> <span class="o">=</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">value</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
  <span class="k">return</span> <span class="n">encodeLong</span><span class="o">(</span><span class="n">longValue</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>All the encoding methods mentioned above can be also used for encoding the atomic information of more complex data structures. An example is about GPS coordinates, that can be encoded as a sequence of two real numbers.</p>
<p>Methods for decoding are reported below:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">decodeBoolean</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">decodeInt</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">decodeLong</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">decodeDouble</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
<span class="kd">protected</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">decodeString</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
</pre></div>
</td></tr></table></div>
<p>For example, in case of <code class="docutils literal"><span class="pre">CORE.TIMESTAMP</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">Object</span> <span class="nf">decode</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Invalid TIMESTAMP binary value&quot;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">decodeLong</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="value-type-arrays">
<h3>3.4.2.4. Value Type Arrays<a class="headerlink" href="#value-type-arrays" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it&#8217;s important to handle data in form of array. Some examples can be an array of URLs containing a list of favorite web addresses or an array of phone numbers with all references for a contact.</p>
<p>For implementing an array of value types it&#8217;s possible to extend the abstract class:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">com</span><span class="o">.</span><span class="na">atooma</span><span class="o">.</span><span class="na">engine</span><span class="o">.</span><span class="na">ArrayValueType</span>
</pre></div>
</td></tr></table></div>
<p>This class extends <code class="docutils literal"><span class="pre">ValueType</span></code> and requires the implementation of the following abstract methods:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encodeItem</span><span class="o">(</span><span class="n">Object</span> <span class="n">item</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">decodeItem</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">item</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span>
</pre></div>
</td></tr></table></div>
<p>These methods must implements the procedure for the encoding / decoding of single elements within the entire array (they should be the same used for the value type of the single element of the array).</p>
</div>
<div class="section" id="id1">
<h3>3.4.2.5. Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">VT_Timestamp</span> <span class="kd">extends</span> <span class="n">ValueType</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getValueClass</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">encode</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">longValue</span> <span class="o">=</span> <span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">value</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">encodeLong</span><span class="o">(</span><span class="n">longValue</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">decode</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Invalid TIMESTAMP binary value&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">decodeLong</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getStringRepresentation</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">mod_core_timestamp_pattern</span><span class="o">);</span>
    <span class="n">DateFormat</span> <span class="n">df</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">((</span><span class="n">Long</span><span class="o">)</span> <span class="n">value</span><span class="o">));</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="registering-value-types">
<h3>3.4.2.6. Registering Value Types<a class="headerlink" href="#registering-value-types" title="Permalink to this headline">¶</a></h3>
<p>Every value type must be registered to module it belongs to as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">registerValueType</span><span class="o">(</span><span class="s">&quot;TIMESTAMP&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">VT_Timestamp</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="creating-triggers">
<span id="devtriggers"></span><h2>3.4.3. Creating Triggers<a class="headerlink" href="#creating-triggers" title="Permalink to this headline">¶</a></h2>
<p>Triggers are components responsible for rules activation when a specific event occurs. Some examples are <code class="docutils literal"><span class="pre">WIFI.ENABLED</span></code> or <code class="docutils literal"><span class="pre">SMS.INCOMING</span></code>. Every trigger may require an optional list of input parameters and provide a list of output variables.</p>
<p>In order to create a new trigger it&#8217;s possible to extend one specific abstract class among the followings:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">com.atooma.engine.IntentBasedTrigger</span></code> - Activation of <strong>intent-based triggers</strong> relies on the reception of a specific intent from Android system.</li>
<li><code class="docutils literal"><span class="pre">com.atooma.engine.AlarmBasedTrigger</span></code> - Activation of <strong>alarm-based triggers</strong> relies on periodic checks of specific conditions.</li>
<li><code class="docutils literal"><span class="pre">com.atooma.engine.Trigger</span></code> - Activation of generic <strong>triggers</strong> relies on custom logic not matching with neither of the previous cases.</li>
</ul>
<p>Regardless of trigger type, all triggers are required to implement the following methods:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>Additional methods are requested depending on trigger type:</p>
<p><strong>IntentBasedTrigger</strong></p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">IntentFilter</span> <span class="nf">getIntentFilter</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">received</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p><strong>AlarmBasedTrigger</strong></p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">ScheduleInfo</span> <span class="nf">getScheduleInfo</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">timeout</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p><strong>Trigger</strong></p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">revoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="declaring-parameters">
<h3>3.4.3.1. Declaring Parameters<a class="headerlink" href="#declaring-parameters" title="Permalink to this headline">¶</a></h3>
<p>Parameters required by triggers must be declared in the implementation of the abstract method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>This method must include a sequence of calls to the inherited method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameter</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">module</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeId</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">required</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> is the identifier of the required parameter.</li>
<li><code class="docutils literal"><span class="pre">module</span></code> and <code class="docutils literal"><span class="pre">typeId</span></code> identify value type, indicating respectively the module and the identifier of the referenced value type.</li>
<li><code class="docutils literal"><span class="pre">required</span></code> indicates whether parameter is mandatory or can be <code class="docutils literal"><span class="pre">null</span></code>.</li>
</ul>
<p>Below is reported an example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;CONNECTED&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;BOOLEAN&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="declaring-variables">
<h3>3.4.3.2. Declaring Variables<a class="headerlink" href="#declaring-variables" title="Permalink to this headline">¶</a></h3>
<p>Variables that can be used as output for a trigger must be explicitly declared in the implementation of method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>This method must include a sequence of calls to the inherited method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariable</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">module</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeId</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> is the identifier of the output variable.</li>
<li><code class="docutils literal"><span class="pre">module</span></code> and <code class="docutils literal"><span class="pre">typeId</span></code> identify value type, indicating respectively the module and the identifier of the referenced value type.</li>
</ul>
<p>Below is reported an example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;SMS-TEXT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">);</span>
  <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;SMS-SENDER&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">);</span>
  <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;SMS-TIME&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;TIMESTAMP&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="activating-rules">
<h3>3.4.3.3. Activating Rules<a class="headerlink" href="#activating-rules" title="Permalink to this headline">¶</a></h3>
<p>When the event monitored by a trigger occurs, the trigger itself must notify the rule execution engine, allowing to proceed with rule next steps (either condition checkers or performers).</p>
<p>The following method must be used for this purpose:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">trigger</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">variables</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule to activate.</li>
<li><code class="docutils literal"><span class="pre">variables</span></code> is a map with all the output variables. The key of the map is the variable identifier (according to declarations made in method <code class="docutils literal"><span class="pre">declareVariables()</span></code>), while value must be of the Java type declared by the value type.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It&#8217;s mandatory for a trigger to produce as output all variables declared in method <code class="docutils literal"><span class="pre">declareVariables()</span></code>.</p>
</div>
</div>
<div class="section" id="intent-based-triggers">
<h3>3.4.3.4. Intent Based Triggers<a class="headerlink" href="#intent-based-triggers" title="Permalink to this headline">¶</a></h3>
<p>Activation of <strong>intent-based triggers</strong> is based on the reception of a specific intent from Android system. Some examples of intent-based triggers are <code class="docutils literal"><span class="pre">SMS.RECEIVED</span></code> and <code class="docutils literal"><span class="pre">WIFI.CONNECTION-STATE-CHANGED</span></code>.</p>
<p>In order to develop an intent-based trigger, the abstract class <code class="docutils literal"><span class="pre">com.atooma.engine.IntentBasedTrigger</span></code> must be implemented. Following methods are requested:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>      <span class="kd">protected</span> <span class="n">IntentFilter</span> <span class="nf">getIntentFilter</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">received</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>Trigger implementation must generate and return an intent filter when following method is invoked:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">IntentFilter</span> <span class="nf">getIntentFilter</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule to create the intent filter for.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
</ul>
<p>All intents intercepted by the generated filter will be notified to the trigger through an invocation of the method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>      <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">received</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
<li><code class="docutils literal"><span class="pre">intent</span></code> is the intercepted intent.</li>
</ul>
<p>Of course all values within the received intent must be checked before invoking the <code class="docutils literal"><span class="pre">trigger()</span></code> method.</p>
<p>An example of intent-based trigger is <code class="docutils literal"><span class="pre">SMS.INCOMING</span></code>, that is the trigger intercepting the incoming SMS event. When such event occur, Android system notifies all interested objects throught a broadcast intent called <code class="docutils literal"><span class="pre">android.provider.Telephony.SMS_RECEIVED</span></code>, that also includes details concerned with the message itself (e.g. sender, content and so on).</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">TR_Incoming</span> <span class="kd">extends</span> <span class="n">IntentBasedTrigger</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;SENDER&quot;</span><span class="o">,</span> <span class="s">&quot;CONTACTS&quot;</span><span class="o">,</span> <span class="s">&quot;PHONE-NUMBER&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;TEXT-FILTER&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;TEXT-FILTER&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;TEXT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">);</span>
    <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;TIMESTAMP&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;TIMESTAMP&quot;</span><span class="o">);</span>
    <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;SENDER-NAME&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">);</span>
    <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;SENDER-PHONE-NUMBER&quot;</span><span class="o">,</span> <span class="s">&quot;CONTACTS&quot;</span><span class="o">,</span> <span class="s">&quot;PHONE-NUMBER&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">IntentFilter</span> <span class="nf">getIntentFilter</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">IntentFilter</span><span class="o">(</span><span class="s">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">received</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Bundle</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getExtras</span><span class="o">();</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">pdus</span> <span class="o">=</span> <span class="o">(</span><span class="n">Object</span><span class="o">[])</span> <span class="n">extras</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;pdus&quot;</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">pdus</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">pdu</span> <span class="o">:</span> <span class="n">pdus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SmsMessage</span> <span class="n">sms</span> <span class="o">=</span> <span class="n">SmsMessage</span><span class="o">.</span><span class="na">createFromPdu</span><span class="o">((</span><span class="kt">byte</span><span class="o">[])</span> <span class="n">pdu</span><span class="o">);</span>
        <span class="c1">// we must inject declared variables into rule execution context</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">variables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
        <span class="n">variables</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;TEXT&quot;</span><span class="o">,</span> <span class="n">sms</span><span class="o">.</span><span class="na">getMessageBody</span><span class="o">());</span>
        <span class="n">variables</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;TIMESTAMP&quot;</span><span class="o">,</span> <span class="n">sms</span><span class="o">.</span><span class="na">getTimestampMillis</span><span class="o">());</span>
        <span class="n">String</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="na">getDisplayOriginatingAddress</span><span class="o">();</span>
        <span class="n">variables</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;SENDER-NAME&quot;</span><span class="o">,</span> <span class="n">sms</span><span class="o">.</span><span class="na">getDisplayOriginatingAddress</span><span class="o">());</span>
        <span class="n">PhoneNumber</span> <span class="n">phoneNumber</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">origin</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">phoneNumber</span> <span class="o">=</span> <span class="n">PhoneNumber</span><span class="o">.</span><span class="na">resolvePhoneNumber</span><span class="o">(</span><span class="n">origin</span><span class="o">,</span> <span class="n">getContext</span><span class="o">());</span>
          <span class="n">variables</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;SENDER-PHONE-NUMBER&quot;</span><span class="o">,</span> <span class="n">phoneNumber</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">PhoneNumber</span> <span class="n">senderFilter</span> <span class="o">=</span> <span class="o">(</span><span class="n">PhoneNumber</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;SENDER&quot;</span><span class="o">);</span>
        <span class="n">TextFilter</span> <span class="n">textFilter</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextFilter</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;TEXT-FILTER&quot;</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">senderMatch</span> <span class="o">=</span> <span class="n">senderFilter</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span>
            <span class="o">(</span><span class="n">phoneNumber</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">phoneNumber</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">senderFilter</span><span class="o">));</span>
        <span class="kt">boolean</span> <span class="n">textMatch</span> <span class="o">=</span> <span class="n">textFilter</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span>
            <span class="n">textFilter</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">sms</span><span class="o">.</span><span class="na">getMessageBody</span><span class="o">());</span>
        <span class="c1">// triggering rule only if sender and text match</span>
        <span class="c1">// with provided values</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">senderMatch</span> <span class="o">&amp;&amp;</span> <span class="n">textMatch</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">trigger</span><span class="o">(</span><span class="n">ruleId</span><span class="o">,</span> <span class="n">variables</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="alarm-based-triggers">
<h3>3.4.3.5. Alarm Based Triggers<a class="headerlink" href="#alarm-based-triggers" title="Permalink to this headline">¶</a></h3>
<p>Activation of <strong>alarm-based triggers</strong> is based on periodic verification of specific events. A typical example is represented by the integration with web services or third party API, but they can be useful iven in case it&#8217;s not possible to exploit any Android Intent. Some examples of intent-based triggers are <code class="docutils literal"><span class="pre">CORE.ALARM</span></code> and <code class="docutils literal"><span class="pre">FACEBOOK.STATUS_UPDATED</span></code>.</p>
<p>In order to develop an alarm-based trigger, the abstract class <code class="docutils literal"><span class="pre">com.atooma.engine.AlarmBasedTrigger</span></code> must be implemented. Following methods are requested:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">ScheduleInfo</span> <span class="nf">getScheduleInfo</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onTimeout</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>Trigger implementation must generate and return all information for defining a proper timer (scheduling) when following method is invoked:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">ScheduleInfo</span> <span class="nf">getScheduleInfo</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
</ul>
<p>It&#8217;s possible to use different constructors for building different types of <code class="docutils literal"><span class="pre">ScheduleInfo</span></code> objects.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="nf">ScheduleInfo</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">repeat</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">exact</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">wakeUp</span><span class="o">,</span>
          <span class="n">Long</span> <span class="n">triggerAtTime</span><span class="o">,</span> <span class="n">Long</span> <span class="n">interval</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">repeat</span></code> indicates whether timer must be reinitialized after first timeout.</li>
<li><code class="docutils literal"><span class="pre">exact</span></code> is used for declaring if timer expiration must be strictly linked with parameters <code class="docutils literal"><span class="pre">triggerAtTime</span></code> and <code class="docutils literal"><span class="pre">interval</span></code> or if it&#8217;s possible for Android to optimize it taking care of eventual other contiguous timers.</li>
<li><code class="docutils literal"><span class="pre">wakeUp</span></code> if <em>true</em> forces device to wake up when timer timeout occurs, if <em>false</em> allow to postpone timeout code execution to the next wake up.</li>
<li><code class="docutils literal"><span class="pre">triggerAtTime</span></code> is the time in <code class="docutils literal"><span class="pre">System.currentTimeMillis()</span></code> of the first timeout (if past, trigger will be immediately activated).</li>
<li><code class="docutils literal"><span class="pre">interval</span></code> is the trigger repetition interval in mills. It is ignored if <code class="docutils literal"><span class="pre">repeat</span></code> value is <em>false</em>.</li>
</ul>
<p>Instead of using an explicit constructor it&#8217;s also possible to exploit specific factory methods of <code class="docutils literal"><span class="pre">ScheduleInfo</span></code> class for building timers.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ScheduleInfo</span> <span class="nf">singleExecution</span><span class="o">(</span><span class="kt">long</span> <span class="n">time</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>This method creates a <code class="docutils literal"><span class="pre">ScheduleInfo</span></code> representing a timer with single execution at specific time and is equivalent to:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="n">ScheduleInfo</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">time</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>While:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">ScheduleInfo</span> <span class="nf">inexactRepeatEvery</span><span class="o">(</span><span class="kt">long</span> <span class="n">interval</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>This method creates a <code class="docutils literal"><span class="pre">ScheduleInfo</span></code> representing a timer with immediate execution, to be repeated every <em>interval</em> mills without strict and specific execution time. It&#8217;s equivalent to:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="n">ScheduleInfo</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">(),</span> <span class="n">interval</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>At every timer timeout, trigger method <code class="docutils literal"><span class="pre">onTimeout()</span></code> is invoked. Its implementation includes logic for checking whether <code class="docutils literal"><span class="pre">trigger()</span></code> method must be invoked for activating the rule or not.</p>
<p>An example of alarm-based trigger is <code class="docutils literal"><span class="pre">CORE.ALARM</span></code>, that works exactly like an alarm and doesn&#8217;t require any verification in <code class="docutils literal"><span class="pre">onTimeout()</span></code> method.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TR_Alarm</span> <span class="kd">extends</span> <span class="n">AlarmBasedTrigger</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;TIME&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;TIMESTAMP&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;REPEAT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;BOOLEAN&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// no variable defined</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">ScheduleInfo</span> <span class="nf">getScheduleInfo</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Long</span> <span class="n">time</span> <span class="o">=</span> <span class="o">(</span><span class="n">Long</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;TIME&quot;</span><span class="o">);</span>
    <span class="n">Boolean</span> <span class="n">repeat</span> <span class="o">=</span> <span class="o">(</span><span class="n">Boolean</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;REPEAT&quot;</span><span class="o">);</span>
    <span class="c1">// repeat interval (24 hours)</span>
    <span class="c1">// to be ignored if repeat == false</span>
    <span class="kt">long</span> <span class="n">aDay</span> <span class="o">=</span> <span class="mi">1000l</span> <span class="o">*</span> <span class="mi">60l</span> <span class="o">*</span> <span class="mi">60l</span> <span class="o">*</span> <span class="mi">24l</span><span class="o">;</span>
    <span class="c1">// the next deadline</span>
    <span class="kt">long</span> <span class="n">triggerAtTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="na">longValue</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">triggerAtTime</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// if provided time is before current,</span>
      <span class="c1">// alarm is moved to next day</span>
      <span class="kt">long</span> <span class="n">difference</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">triggerAtTime</span><span class="o">;</span>
      <span class="kt">int</span> <span class="n">days</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">difference</span> <span class="o">/</span> <span class="n">aDay</span><span class="o">);</span>
      <span class="n">triggerAtTime</span> <span class="o">+=</span> <span class="o">(</span><span class="n">aDay</span> <span class="o">*</span> <span class="n">days</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ScheduleInfo</span><span class="o">(</span><span class="n">repeat</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">triggerAtTime</span><span class="o">,</span> <span class="n">aDay</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onTimeout</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// no condition to be verified</span>
    <span class="c1">// possible to directly proceed</span>
    <span class="c1">// with rule triggering</span>
    <span class="n">trigger</span><span class="o">(</span><span class="n">ruleId</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="custom-triggers">
<h3>3.4.3.6. Custom Triggers<a class="headerlink" href="#custom-triggers" title="Permalink to this headline">¶</a></h3>
<p>In case trigger to be implemented doesn&#8217;t match to any of the previous categories, it&#8217;s possible to proceed at low level by directly extending the <code class="docutils literal"><span class="pre">com.atooma.engine.Trigger</span></code> class.</p>
<p>Methods to be implemented are reported below:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">revoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>Method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<p>Is used for implementing logic deciding when a rule must be activated.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
</ul>
<p>As soon as a rule doesn&#8217;t want anymore to receive notification about event to be monitored, following method will be invoked:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">revoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule that asked for event notification stop.</li>
</ul>
</div>
<div class="section" id="registering-triggers">
<h3>3.4.3.7. Registering Triggers<a class="headerlink" href="#registering-triggers" title="Permalink to this headline">¶</a></h3>
<p>Every trigger must be registered to module it belongs to as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">registerTrigger</span><span class="o">(</span><span class="s">&quot;RECEIVED&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">TR_Received</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="creating-condition-checkers">
<span id="devconditioncheckers"></span><h2>3.4.4. Creating Condition Checkers<a class="headerlink" href="#creating-condition-checkers" title="Permalink to this headline">¶</a></h2>
<p>Condition checkers are used by a module for allowing to check a condition when they are invoked and return a boolean outcome. They may require optional parameters.</p>
<p>In order to create a new condition checker abstract class <code class="docutils literal"><span class="pre">com.atooma.engine.ConditionChecker</span></code> must be extended, including implementation of following methods:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id2">
<h3>3.4.4.1. Declaring Parameters<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Parameters required by a condition checker must be declared within method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>This method must include a sequence of calls to the inherited method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameter</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">module</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeId</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">required</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> is the identifier of the required parameter.</li>
<li><code class="docutils literal"><span class="pre">module</span></code> and <code class="docutils literal"><span class="pre">typeId</span></code> identify value type, indicating respectively the module and the identifier of the referenced value type.</li>
<li><code class="docutils literal"><span class="pre">required</span></code> indicates whether parameter is mandatory or can be <code class="docutils literal"><span class="pre">null</span></code>.</li>
</ul>
<p>Below is reported an example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;STR1&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;STR2&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;CASE-SENSITIVE&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;BOOLEAN&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="invoking-condition-checkers">
<h3>3.4.4.2. Invoking Condition Checkers<a class="headerlink" href="#invoking-condition-checkers" title="Permalink to this headline">¶</a></h3>
<p>When a rule requires condition handled by a condition checker to be verified, the following method is invoked:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule that asked for condition verification.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
</ul>
<p>Method complete its execution returning a boolean value, <em>true</em> if condition is verified, <em>false</em> otherwise.</p>
</div>
<div class="section" id="id3">
<h3>3.4.4.3. Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">WIFI.CONNECTED</span></code> condition checker allows to control if WiFi is enabled and connected. It requires an optional parameter <code class="docutils literal"><span class="pre">SSID</span></code> with Type <code class="docutils literal"><span class="pre">CORE.STRING</span></code>, that reports the identifier of the WiFi network to check. In case such parameter is not defined, connection to any network is positively evaluated.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CC_Connected</span> <span class="kd">extends</span> <span class="n">ConditionChecker</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;SSID&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">WifiManager</span> <span class="n">wifiManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">WifiManager</span><span class="o">)</span> <span class="n">getContext</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WIFI_SERVICE</span><span class="o">);</span>
    <span class="n">WifiInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">wifiManager</span><span class="o">.</span><span class="na">getConnectionInfo</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">info</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">ssid</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;SSID&quot;</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">ssid</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">ssid</span> <span class="o">=</span> <span class="n">ssid</span><span class="o">.</span><span class="na">trim</span><span class="o">()).</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">WifiManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="o">(</span><span class="n">WifiManager</span><span class="o">)</span> <span class="n">getContext</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WIFI_SERVICE</span><span class="o">);</span>
        <span class="n">WifiInfo</span> <span class="n">wifiInfo</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getConnectionInfo</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">wifiInfo</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">String</span> <span class="n">networkSsid</span> <span class="o">=</span> <span class="n">wifiInfo</span><span class="o">.</span><span class="na">getSSID</span><span class="o">();</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">ssid</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">networkSsid</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="registering-condition-checkers">
<h3>3.4.4.4. Registering Condition Checkers<a class="headerlink" href="#registering-condition-checkers" title="Permalink to this headline">¶</a></h3>
<p>Every trigger must be registered to module it belongs to as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">registerConditionChecker</span><span class="o">(</span><span class="s">&quot;STR-EQUALS&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">CC_StrEquals</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="trigger-and-condition-checker-affinity">
<h2>3.4.5. Trigger and Condition Checker Affinity<a class="headerlink" href="#trigger-and-condition-checker-affinity" title="Permalink to this headline">¶</a></h2>
<p>Even if trigger and condition checkers are classes with own lifecycle, extending different superclasses, some semantic associations can be sometimes defined between them.</p>
<p>When declaring a trigger and a condition checker with same ID, they are considered as related. This means that regardless of which component is choosen, engine may decide to use trigger or condition checker depending on situation.</p>
<p>Making a trigger and a condition checker as related requires in any case some constraints to observe:</p>
<ol class="arabic simple">
<li>They must have the same list of parameters</li>
<li>Trigger cannot export variables. Trigger exporting variables cannot be related to a condition checker.</li>
<li>They must declare the same UI category.</li>
</ol>
</div>
<div class="section" id="creating-performers">
<span id="devperformers"></span><h2>3.4.6. Creating Performers<a class="headerlink" href="#creating-performers" title="Permalink to this headline">¶</a></h2>
<p>Performers are components responsible of executing operations on demand, as requested by rules they are declared in. They may require optional parameters and can produce optional variables in output.</p>
<p>In order to create a new condition checker abstract class <code class="docutils literal"><span class="pre">com.atooma.engine.Performer</span></code> must be extended, including implementation of following methods:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span>
<span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id4">
<h3>3.4.6.1. Declaring Parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Parameters required by a performer must be declared within method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>This method must include a sequence of calls to the inherited method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameter</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">module</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeId</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">required</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> is the identifier of the required parameter.</li>
<li><code class="docutils literal"><span class="pre">module</span></code> and <code class="docutils literal"><span class="pre">typeId</span></code> identify value type, indicating respectively the module and the identifier of the referenced value type.</li>
<li><code class="docutils literal"><span class="pre">required</span></code> indicates whether parameter is mandatory or can be <code class="docutils literal"><span class="pre">null</span></code>.</li>
</ul>
<p>Below is reported an example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;TEXT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id5">
<h3>3.4.6.2. Declaring Variables<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Variables that can be used as output for a performer must be explicitly declared in the implementation of method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
<p>This method must include a sequence of calls to the inherited method:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariable</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">module</span><span class="o">,</span> <span class="n">String</span> <span class="n">typeId</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> is the identifier of the output variable.</li>
<li><code class="docutils literal"><span class="pre">module</span></code> and <code class="docutils literal"><span class="pre">typeId</span></code> identify value type, indicating respectively the module and the identifier of the referenced value type.</li>
</ul>
<p>Below is reported an example:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">declareVariable</span><span class="o">(</span><span class="s">&quot;RESULT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;BOOLEAN&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="invoking-performers">
<h3>3.4.6.3. Invoking Performers<a class="headerlink" href="#invoking-performers" title="Permalink to this headline">¶</a></h3>
<p>When a rule requires a performer to execute a set of actions, the following method is invoked:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ruleId</span></code> is the identifier of the rule that asked for condition verification.</li>
<li><code class="docutils literal"><span class="pre">parameters</span></code> is a map with all the parameters that are input for the rule, according to names and types defined in method <code class="docutils literal"><span class="pre">declareParameters()</span></code>.</li>
</ul>
<p>Method complete its execution returning a map of variables, to be compliant with declarations made in method <code class="docutils literal"><span class="pre">declareVariables()</span></code>.</p>
</div>
<div class="section" id="id6">
<h3>3.4.6.4. Example<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">NOTIFICATION.TOAST</span></code> performer shows a toast message to the user. It requires a parameter <code class="docutils literal"><span class="pre">TEXT</span></code> with Type <code class="docutils literal"><span class="pre">CORE.STRING</span></code>, that represents the message to be displayed.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">PE_Toast</span> <span class="kd">extends</span> <span class="n">Performer</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareParameters</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">declareParameter</span><span class="o">(</span><span class="s">&quot;TEXT&quot;</span><span class="o">,</span> <span class="s">&quot;CORE&quot;</span><span class="o">,</span> <span class="s">&quot;STRING&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">declareVariables</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// no variables</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">String</span> <span class="n">ruleId</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">parameters</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;TEXT&quot;</span><span class="o">);</span>
    <span class="n">Handler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">());</span>
    <span class="n">handler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">text</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">});</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="registering-performers">
<h3>3.4.6.5. Registering Performers<a class="headerlink" href="#registering-performers" title="Permalink to this headline">¶</a></h3>
<p>Every trigger must be registered to module it belongs to as follows:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">registerComponents</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">registerPerformer</span><span class="o">(</span><span class="s">&quot;TOAST&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">PE_Toast</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/andprogramming.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2016, Atooma Inc.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>