
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.2. Rules Engine &mdash; Resonance AI SDK 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/atooma.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Resonance AI SDK 2.1.0 documentation" href="index.html" />
    <link rel="up" title="4. Resonance Android SDK framework" href="android.html" />
    <link rel="next" title="4.3. Defining Rules With XML" href="andxml.html" />
    <link rel="prev" title="4.1. Core Concepts" href="andcore.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Resonance AI SDK</a>
        <span class="navbar-text navbar-version pull-left"><b>2.1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-we-believe">1.1. What We Believe?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-is-resonance-why-there-is-an-atooma-app-on-the-market">1.2. What Is Resonance - Why There Is An Atooma App On The Market?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-is-resonance-sdk">1.3. What Is Resonance SDK?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-you-need">1.4. What You Need?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getstart.html">2. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#declaring-features-of-interest">2.1. Declaring Features of Interest</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#data-sources-definition">2.2. Data Sources Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstart.html#rule-engine-configuration">2.3. Rule Engine Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="iosstart.html">3. Resonance iOS SDK framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#add-the-sdk-to-your-xcode-project">3.1. Add the SDK to your Xcode Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#configure-the-app-capabilities">3.1.1. Configure the app capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#set-the-location-service-permission-string">3.1.2. Set the Location Service permission string</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#objective-c">3.1.3. Objective-C</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#all-set">3.1.4. All set!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#data-collector">3.2. Data Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#configure-the-collector">3.2.1. Configure the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#ask-for-permission">3.2.2. Ask for Permission</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#start-the-collector">3.2.3. Start the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#stop-the-collector">3.2.4. Stop the collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#logger">3.2.5. Logger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iosstart.html#activity-tracking">3.3. Activity Tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#history">3.3.1. History</a></li>
<li class="toctree-l3"><a class="reference internal" href="iosstart.html#realtime-event-monitoring-beta">3.3.2. Realtime Event Monitoring (Beta)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="android.html">4. Resonance Android SDK framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="andcore.html">4.1. Core Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#modules">4.1.1. Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#rules">4.1.2. Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andcore.html#data-analysis">4.1.3. Data Analysis</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. Rules Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-ruledefinition-class">4.2.1. The <em>RuleDefinition</em> Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-atooma-class">4.2.2. The <em>Atooma</em> Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-ruleconflictschecker-class">4.2.3. The <em>RuleConflictsChecker</em> Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andxml.html">4.3. Defining Rules With XML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#property-values">4.3.1. Property Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#external-provider-calls">4.3.2. External Provider Calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#example">4.3.3. Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="andxml.html#atooma-binary-format">4.3.4. Atooma binary format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andprogramming.html">4.4. Developing Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#creating-modules">4.4.1. Creating Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#creating-value-types">4.4.2. Creating Value Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#creating-triggers">4.4.3. Creating Triggers</a></li>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#creating-condition-checkers">4.4.4. Creating Condition Checkers</a></li>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#trigger-and-condition-checker-affinity">4.4.5. Trigger and Condition Checker Affinity</a></li>
<li class="toctree-l3"><a class="reference internal" href="andprogramming.html#creating-performers">4.4.6. Creating Performers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andreference.html">4.5. Modules API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#oauth-based-modules">4.5.1. OAuth Based Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#activity-manager">4.5.2. Activity Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#airplane">4.5.3. Airplane</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#alarm">4.5.4. Alarm</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#battery">4.5.5. Battery</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#bluetooth">4.5.6. Bluetooth</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#camera">4.5.7. Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#contacts">4.5.8. Contacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#core">4.5.9. Core</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#data-sync">4.5.10. Data Sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-dropbox">4.5.11. Dropbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#facebook">4.5.12. Facebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#google-calendar">4.5.13. Google Calendar</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#google-drive">4.5.14. Google Drive</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#gmail">4.5.15. Gmail</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#headphone">4.5.16. Headphone</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-instagram">4.5.17. Instagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#location">4.5.18. Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#notification">4.5.19. Notification</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#shake">4.5.20. Shake</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#sms">4.5.21. SMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#telephony">4.5.22. Telephony</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#text-to-speech">4.5.23. Text To Speech</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#module-twitter">4.5.24. Twitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#wifi">4.5.25. WiFi</a></li>
<li class="toctree-l3"><a class="reference internal" href="andreference.html#weather">4.5.26. Weather</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andactivity.html">4.6. Activity Tracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#theoretical-basis">4.6.1. Theoretical Basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#monitoring-events">4.6.2. Monitoring Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#accessing-activity-history">4.6.3. Accessing activity history</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#sub-activities">4.6.4. Sub Activities</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#next-steps">4.6.5. Next Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="andactivity.html#bibliography">4.6.6. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andresonance.html">4.7. Resonance API Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#theoretical-basis">4.7.1. Theoretical Basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#resonanceapiclient-class">4.7.2. <em>ResonanceApiClient</em> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#data-collector">4.7.3. Data Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#advisor">4.7.4. Advisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#next-steps">4.7.5. Next Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="andresonance.html#bibliography">4.7.6. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="andexamples.html">4.8. Building Own Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-0-rule-engine-basics">4.8.1. Example 0 - Rule Engine Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-1-external-providers">4.8.2. Example 1 - External Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-2-custom-modules">4.8.3. Example 2 - Custom Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-3-xml-as-a-template">4.8.4. Example 3 - XML As A Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-4-parking-reminder">4.8.5. Example 4 - Parking Reminder</a></li>
<li class="toctree-l3"><a class="reference internal" href="andexamples.html#example-5-timeline">4.8.6. Example 5 - Timeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="android.html#stable-gradle-configuration">4.9. Stable Gradle Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="android.html#basic-manifest-configuration">4.10. Basic Manifest Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="android.html#changelog">4.11. Changelog</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">4.2. Rules Engine</a><ul>
<li><a class="reference internal" href="#the-ruledefinition-class">4.2.1. The <em>RuleDefinition</em> Class</a></li>
<li><a class="reference internal" href="#the-atooma-class">4.2.2. The <em>Atooma</em> Class</a></li>
<li><a class="reference internal" href="#the-ruleconflictschecker-class">4.2.3. The <em>RuleConflictsChecker</em> Class</a><ul>
<li><a class="reference internal" href="#about-opposite-conditions">4.2.3.1. About Opposite Conditions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="rules-engine">
<span id="andengine"></span><h1>4.2. Rules Engine<a class="headerlink" href="#rules-engine" title="Permalink to this headline">¶</a></h1>
<p>Target of this section is to provide details on main classes included in Resonance SDK, with main reference to Rules Engine part.</p>
<div class="section" id="the-ruledefinition-class">
<span id="ruledefinition"></span><h2>4.2.1. The <em>RuleDefinition</em> Class<a class="headerlink" href="#the-ruledefinition-class" title="Permalink to this headline">¶</a></h2>
<p>Rules are represented within the execution engine by using instances belonging to the <code class="docutils literal"><span class="pre">RuleDefinition</span></code> class. Going in depth with details about its implementation is not essential. What is important is to understand is how to get a <code class="docutils literal"><span class="pre">RuleDefinition</span></code> instance starting from its XML representation.</p>
<p>For such purpose, Atooma SDK provides an important utility, the <code class="docutils literal"><span class="pre">XMLDeserializer</span></code>, that is a class implementing useful methods for properly deserializing XML files. In particular static method <code class="docutils literal"><span class="pre">deserialize</span></code> allows to get a <code class="docutils literal"><span class="pre">RuleDefinition</span></code> instance, starting from its XML representation, as shown below:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// getting rule definition with provided id</span>
<span class="n">RuleDefinition</span> <span class="n">def_1</span> <span class="o">=</span> <span class="n">XMLDeserializer</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>

<span class="c1">// getting rule definition with automatically generated id</span>
<span class="n">RuleDefinition</span> <span class="n">def_2</span> <span class="o">=</span> <span class="n">XMLDeserializer</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>As you can see, two methods are defined for deserializing an XML stream and building the corresponding <code class="docutils literal"><span class="pre">RuleDefinition</span></code> object. Main difference is represented by the possibility of manually defining an identifier for the rule.</p>
<p>Rule identifiers are extremely important because they are used as keys within rule execution engine. This means that same rule can be loaded twice in case of different identifier, while it is loaded only once in case identifier is the same. Be aware that asking <code class="docutils literal"><span class="pre">XMLDeserializer</span></code> to automatically assign a rule identifier has the effect of generating a UUID value for it. That&#8217;s why it&#8217;s commonly preferred to define a custom strategy for assigning identifiers to rules (e.g. using an hash of rule title can be a simple example).</p>
</div>
<div class="section" id="the-atooma-class">
<h2>4.2.2. The <em>Atooma</em> Class<a class="headerlink" href="#the-atooma-class" title="Permalink to this headline">¶</a></h2>
<p>Working with Atooma Rules Engine requires developers to use <code class="docutils literal"><span class="pre">Atooma</span></code> singleton class, that is the main interface for accessing all core Atooma features and functionalities, such as loading and unloading rules.</p>
<p>It follows a list of the main methods and properties that can be used for properly configuring and exploiting Atooma class:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Initialize the engine, loading all provided modules.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Module</span><span class="o">[]</span> <span class="n">module</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Load a rule into the Atooma engine, starting from the corresponding</span>
<span class="cm"> * xml stream. Returns true in case operation is completed successfully,</span>
<span class="cm"> * false otherwise.</span>
<span class="cm"> */</span>
<span class="kt">boolean</span> <span class="nf">loadRule</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">stream</span><span class="o">,</span> <span class="n">RuleConflictsChecker</span> <span class="n">checker</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Load a rule into the Atooma engine, starting from its Rule Definition.</span>
<span class="cm"> * Returns true in case operation is completed successfully, false otherwise.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">loadRule</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">,</span> <span class="n">RuleConflictsChecker</span> <span class="n">checker</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Returns a map with all active rule definitions, having rule ids</span>
<span class="cm"> * as keys.</span>
<span class="cm"> */</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">RuleDefinition</span><span class="o">&gt;</span> <span class="nf">getActiveRules</span><span class="o">()</span>

<span class="cm">/**</span>
<span class="cm"> * Unload rule from engine basing on its id and stopping its execution.</span>
<span class="cm"> */</span>
<span class="kt">boolean</span> <span class="nf">unloadRule</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">)</span>

<span class="cm">/**</span>
<span class="cm"> * Returns true if engine is inited, false otherwise.</span>
<span class="cm"> */</span>
<span class="kt">boolean</span> <span class="nf">isEngineInited</span><span class="o">()</span>

<span class="cm">/**</span>
<span class="cm"> * Stops engine execution.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">halt</span><span class="o">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="the-ruleconflictschecker-class">
<h2>4.2.3. The <em>RuleConflictsChecker</em> Class<a class="headerlink" href="#the-ruleconflictschecker-class" title="Permalink to this headline">¶</a></h2>
<p>Atooma doesn&#8217;t impose any constraint on rules creation. It means that users / developers can create even rules with potential inconsistencies. For example, let&#8217;s consider the rule: <strong>IF</strong> (WiFi ON, WiFi OFF) <strong>DO</strong> (Notification Toast). Of course, such rule will never fire, because it implements two opposing conditions.</p>
<p>In order to handle such kind of situations, Atooma provides an extendible class, that is <code class="docutils literal"><span class="pre">RuleConflictsChecker</span></code>. Such class is responsible for checking whether a rule loading may create problems or not. In particular, there are two possible high level conflicts to be taken into account:</p>
<ol class="arabic simple">
<li><strong>Internal Conflicts</strong> - An internal conflict occurs when the definition of a rule prevent it from firing (as in the example described before).</li>
<li><strong>External Conflicts</strong> - An external conflict occurs when the definition of a rule has components that can interfere with other rule definitions.</li>
</ol>
<p><code class="docutils literal"><span class="pre">RuleConflictsChecker</span></code> class implements following methods for encapsulating the whole conflicts verification logic:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="cm">/**</span>
<span class="cm">   * Adds a checker for internal conflicts.</span>
<span class="cm">   */</span>
  <span class="kt">void</span> <span class="nf">addInternalChecker</span><span class="o">(</span><span class="n">RuleInternalConflictsChecker</span> <span class="n">checker</span><span class="o">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Adds a checker for external conflicts.</span>
<span class="cm">   */</span>
  <span class="kt">void</span> <span class="nf">addExternalChecker</span><span class="o">(</span><span class="n">RuleExternalConflictsChecker</span> <span class="n">checker</span><span class="o">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Checker for internal conflicts within provided</span>
<span class="cm">   * RuleDefinition. true is returned in case rule</span>
<span class="cm">   * can be activated anyway, false otherwise.</span>
<span class="cm">   */</span>
  <span class="kt">boolean</span> <span class="nf">checkInternalConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Checker for external conflicts between provided</span>
<span class="cm">   * RuleDefinition and all the other active rules.</span>
<span class="cm">   * true is returned in case rule can be activated</span>
<span class="cm">   * anyway, false otherwise.</span>
<span class="cm">   */</span>
  <span class="kt">boolean</span> <span class="nf">checkExternalConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">);</span>

  <span class="cm">/**</span>
<span class="cm">   * Checker for external conflicts between provided</span>
<span class="cm">   * RuleDefinition and the other rules in input.</span>
<span class="cm">   * true is returned in case rule can be activated</span>
<span class="cm">   * anyway, false otherwise.</span>
<span class="cm">   */</span>
  <span class="kt">boolean</span> <span class="nf">checkExternalConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">RuleDefinition</span><span class="o">&gt;</span> <span class="n">defs</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>Basing on signatures reported above, it is clear that <code class="docutils literal"><span class="pre">RuleConflictsChecker</span></code> class requires additional checkers to be provided to it in order to implement the overall conflicts verification strategy. Purpose of <code class="docutils literal"><span class="pre">RuleInternalConflictsChecker</span></code> and <code class="docutils literal"><span class="pre">RuleExternalConflictsChecker</span></code> classes is to provide an abstraction for internal and external conflict concepts. Providing new conflict verification criteria means extending such classes, by implementing following methods:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">//RuleInternalConflictsChecker</span>
<span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">hasConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">);</span>

<span class="c1">// RuleExternalConflictsChecker</span>
<span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">haveConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">,</span> <span class="n">RuleDefinition</span> <span class="n">other</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>Please notice that all conflict checkers are created by providing a boolean parameter that is used for declaring whether rule must be activated regardless outcome of conflicts verification or not.</p>
<p>Let&#8217;s suppose we would like to check whether multiple rules share the same trigger. Below is reported sample code for implementation of the corresponding <code class="docutils literal"><span class="pre">RuleExternalConflictsChecker</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SameTriggerConflictsChecker</span> <span class="kd">extends</span> <span class="n">RuleExternalConflictsChecker</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">SameTriggerConflictsChecker</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">activateAnywayay</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">activateAnywayay</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">haveConflicts</span><span class="o">(</span><span class="n">RuleDefinition</span> <span class="n">def</span><span class="o">,</span> <span class="n">RuleDefinition</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TriggerDefinition</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">def</span><span class="o">.</span><span class="na">getTriggerDefinition</span><span class="o">();</span>
    <span class="n">TriggerDefinition</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="na">getTriggerDefinition</span><span class="o">();</span>
    <span class="c1">// In case rule we are going to activate has same trigger</span>
    <span class="c1">// of another active rule, there can be unexpected behaviors</span>
    <span class="k">return</span> <span class="n">tr1</span><span class="o">.</span><span class="na">getModule</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">tr2</span><span class="o">.</span><span class="na">getModule</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">tr1</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">tr2</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>In terms of usage, below is reported sample code for activating a rule taking care of multiple conflict verification criterias:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">RuleConflictsChecker</span> <span class="n">checker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RuleConflictsChecker</span><span class="o">();</span>
<span class="n">checker</span><span class="o">.</span><span class="na">addExternalChecker</span><span class="o">(</span><span class="k">new</span> <span class="n">SameTriggerConflictsChecker</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
<span class="c1">// ...</span>
<span class="n">Atooma</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">loadRule</span><span class="o">(</span><span class="n">def</span><span class="o">,</span> <span class="n">checker</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="about-opposite-conditions">
<h3>4.2.3.1. About Opposite Conditions<a class="headerlink" href="#about-opposite-conditions" title="Permalink to this headline">¶</a></h3>
<p>Atooma SDK provides implementation for two conflict checkers:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">SameTriggerConflictsChecker</span></code> extending <code class="docutils literal"><span class="pre">RuleExternalConflictsChecker</span></code></li>
<li><code class="docutils literal"><span class="pre">OppositeConditionsConflictsChecker</span></code> extending <code class="docutils literal"><span class="pre">RuleInternalConflictsChecker</span></code></li>
</ul>
<p>First one was already discussed in previous section, while second one requires some insights. Starting from version 1.0.7, Atooma engine includes a mechanism for easily declaring component that can be considered as opposite. In practice it&#8217;s enough to use the following declaration in own modules:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Declares to components as opposite by specifying their ids.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">registerOppositeConditions</span><span class="o">(</span><span class="n">String</span> <span class="n">idOne</span><span class="o">,</span> <span class="n">String</span> <span class="n">idTwo</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>By default following rules are already defined for all modules, including the custom ones created by developers:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Such declarations must be used within</span>
<span class="cm"> * registerComponents method for new modules.</span>
<span class="cm"> */</span>
<span class="n">registerOppositeConditions</span><span class="o">(</span><span class="s">&quot;ENABLED&quot;</span><span class="o">,</span> <span class="s">&quot;DISABLED&quot;</span><span class="o">);</span>
<span class="n">registerOppositeConditions</span><span class="o">(</span><span class="s">&quot;CONNECTED&quot;</span><span class="o">,</span> <span class="s">&quot;DISCONNECTED&quot;</span><span class="o">);</span>
<span class="n">registerOppositeConditions</span><span class="o">(</span><span class="s">&quot;ON&quot;</span><span class="o">,</span> <span class="s">&quot;OFF&quot;</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/andengine.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2016, Atooma Inc.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>